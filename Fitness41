<!DOCTYPE html>
<html lang="en" class="bg-white">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA / Mobile Native Feel -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffffff">
    
    <title>Elite41 Power Tracker</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        
        html, body { 
            height: 100%; 
            width: 100%;
            margin: 0; 
            padding: 0; 
            background-color: #ffffff;
            font-family: 'Inter', -apple-system, sans-serif;
            -webkit-font-smoothing: antialiased;
            overscroll-behavior-y: none;
            /* Prevent text selection during workouts */
            user-select: none;
            -webkit-user-select: none;
            overflow: hidden; /* Prevent body scroll to stop layout jumps */
        }
        
        #root {
            height: 100dvh; 
            display: flex;
            flex-direction: column;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            position: fixed; /* Lock container to screen to prevent top-offset jumps */
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .sticky-header {
            flex-shrink: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid #f1f5f9;
            z-index: 100;
            position: relative;
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 80px; /* Extra padding for bottom button clearance */
        }

        /* CRITICAL: Prevent zooming on input focus in iOS */
        input { 
            font-size: 16px !important; /* iOS requires 16px to prevent auto-zoom */
            appearance: none;
            -webkit-appearance: none;
            touch-action: manipulation;
        }
        
        /* Smooth transitions for mobile */
        .fade-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

        /* Custom scrollbar for a cleaner look */
        .main-content::-webkit-scrollbar { width: 0px; background: transparent; }

        /* Active state for mobile buttons */
        .tap-active:active { transform: scale(0.96); opacity: 0.8; }
    </style>
</head>
<body class="text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, size = 20, className = "" }) => {
            const kebabName = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });
            return <i data-lucide={kebabName} className={className} style={{ width: size, height: size }}></i>;
        };

        const vibrate = (type = 'light') => {
            if (!window.navigator.vibrate) return;
            if (type === 'light') window.navigator.vibrate(10);
            else if (type === 'medium') window.navigator.vibrate(30);
            else if (type === 'success') window.navigator.vibrate([20, 50, 20]);
        };

        const WARMUPS = [
            { name: "Cat-Cow", reps: "10 reps" },
            { name: "Bird-Dog", reps: "8/side" },
            { name: "World's Greatest Stretch", reps: "5/side" },
            { name: "Bodyweight Squats", reps: "15 reps" },
            { name: "Arm Circles & Scapular Pulls", reps: "20 reps" }
        ];

        const PHASES = [
            {
                id: 0, name: "Phase A",
                days: [
                    { id: 0, title: "Day 1: Posterior & Pull", supersets: [[{ id: "tbdl", name: "Trap Bar Deadlift", altName: "DB Suitcase DL", reps: "5-8", weight: "Trap Bar", altWeight: "DBs", isLegs: true }, { id: "dbrow", name: "DB One-Arm Row", reps: "10-12", weight: "DB" }], [{ id: "dbgoblet", name: "DB Goblet Squat", reps: "12-15", weight: "DB", isLegs: true }, { id: "dboh", name: "DB Overhead Press", reps: "8-10", weight: "DB" }]] },
                    { id: 1, title: "Day 2: Chest & Core", supersets: [[{ id: "dbbench", name: "DB Bench Press", reps: "8-10", weight: "DB" }, { id: "tbrdl", name: "Trap Bar RDL", altName: "DB RDL", reps: "10-12", weight: "Trap Bar", altWeight: "DBs", isLegs: true }], [{ id: "dbcsr", name: "DB Chest Supported Row", reps: "10-12", weight: "DB" }, { id: "dbren", name: "DB Renegade Rows", reps: "8/side", weight: "DB" }]] },
                    { id: 2, title: "Day 3: Legs & Stability", supersets: [[{ id: "tbsquat", name: "Trap Bar Squat", altName: "DB Goblet Squat", reps: "8-10", weight: "Trap Bar", altWeight: "DBs", isLegs: true }, { id: "dbinc", name: "DB Incline Bench Press", reps: "10-12", weight: "DB" }], [{ id: "dbbulg", name: "DB Bulgarian Split Squat", reps: "8-10", weight: "DB", isLegs: true }, { id: "dbcurls", name: "DB Bicep Curls", reps: "12-15", weight: "DB" }]] }
                ]
            },
            {
                id: 1, name: "Phase B",
                days: [
                    { id: 0, title: "Day 1: Pull & Shrug", supersets: [[{ id: "tbdl_sh", name: "Trap Bar Shrug DL", altName: "DB Shrug DL", reps: "8-10", weight: "Trap Bar", altWeight: "DBs", isLegs: true }, { id: "db_seesaw", name: "DB Seesaw Row", reps: "12/side", weight: "DB" }], [{ id: "db_lat_lunge", name: "DB Lateral Lunge", reps: "10/side", weight: "DB", isLegs: true }, { id: "db_arnold", name: "DB Arnold Press", reps: "10-12", weight: "DB" }]] },
                    { id: 1, title: "Day 2: Push & Carry", supersets: [[{ id: "db_floor", name: "DB Floor Press", reps: "10-12", weight: "DB" }, { id: "tbrdl_b", name: "Trap Bar RDL", altName: "DB RDL", reps: "12-15", weight: "Trap Bar", altWeight: "DBs", isLegs: true }], [{ id: "db_pull", name: "DB Pullover", reps: "12-15", weight: "DB" }, { id: "db_carry", name: "DB Suitcase Carry", reps: "30yd/side", weight: "DB" }]] },
                    { id: 2, title: "Day 3: Quads & Isos", supersets: [[{ id: "tbsq_b", name: "Trap Bar Squat", altName: "DB Goblet Squat", reps: "10-12", weight: "Trap Bar", altWeight: "DBs", isLegs: true }, { id: "db_fly", name: "DB Incline Fly", reps: "12-15", weight: "DB" }], [{ id: "db_step", name: "DB Step Ups", reps: "10/side", weight: "DB", isLegs: true }, { id: "db_ham", name: "DB Hammer Curls", reps: "12-15", weight: "DB" }]] }
                ]
            }
        ];

        function App() {
            const [tab, setTab] = useState('train');
            const [activePhaseIndex, setActivePhaseIndex] = useState(() => Number(localStorage.getItem('elite41_phase') || 0));
            const [activeDayIndex, setActiveDayIndex] = useState(0);
            const [isTravelMode, setIsTravelMode] = useState(() => localStorage.getItem('elite41_travel') === 'true');
            const [isSupersetMode, setIsSupersetMode] = useState(() => (localStorage.getItem('elite41_supersets') || 'true') === 'true');
            const [isPreRunMode, setIsPreRunMode] = useState(() => localStorage.getItem('elite41_prerun') === 'true');
            const [history, setHistory] = useState(() => JSON.parse(localStorage.getItem('elite41_history') || '{}'));
            const [session, setSession] = useState(() => JSON.parse(localStorage.getItem('elite41_session') || '{}'));
            const [timerActive, setTimerActive] = useState(false);
            const [timeLeft, setTimeLeft] = useState(60);
            const [restPreset, setRestPreset] = useState(60);
            const [sessionStartTime, setSessionStartTime] = useState(() => {
                const saved = localStorage.getItem('elite41_start_time');
                return saved ? Number(saved) : null;
            });
            const [elapsedTime, setElapsedTime] = useState(0);

            const mainRef = useRef(null);

            useEffect(() => {
                localStorage.setItem('elite41_phase', activePhaseIndex);
                localStorage.setItem('elite41_travel', isTravelMode);
                localStorage.setItem('elite41_supersets', isSupersetMode);
                localStorage.setItem('elite41_prerun', isPreRunMode);
                localStorage.setItem('elite41_history', JSON.stringify(history));
                localStorage.setItem('elite41_session', JSON.stringify(session));
                if (sessionStartTime) localStorage.setItem('elite41_start_time', sessionStartTime);
            }, [activePhaseIndex, isTravelMode, isSupersetMode, isPreRunMode, history, session, sessionStartTime]);

            useEffect(() => {
                let interval;
                if (timerActive && timeLeft > 0) interval = setInterval(() => setTimeLeft(t => t - 1), 1000);
                else if (timeLeft === 0) {
                    setTimerActive(false);
                    vibrate('medium');
                }
                return () => clearInterval(interval);
            }, [timerActive, timeLeft]);

            useEffect(() => {
                let stopInt;
                if (sessionStartTime) stopInt = setInterval(() => setElapsedTime(Math.floor((Date.now() - sessionStartTime) / 1000)), 1000);
                return () => clearInterval(stopInt);
            }, [sessionStartTime]);

            const activePhase = PHASES[activePhaseIndex] || PHASES[0];
            const activeDay = activePhase.days[activeDayIndex] || activePhase.days[0];
            const formatTime = (s) => `${Math.floor(s / 60)}:${(s % 60).toString().padStart(2, '0')}`;

            const handleToggleSet = (exId, sIdx) => {
                vibrate('light');
                if (!sessionStartTime) setSessionStartTime(Date.now());
                const key = `${exId}-${sIdx}`;
                const isDone = !!session[key];
                setSession(prev => ({ ...prev, [key]: !isDone }));
                if (!isDone) { setTimeLeft(restPreset); setTimerActive(true); }
            };

            const handleCompleteSession = () => {
                vibrate('success');
                if (window.confirm("Complete workout and reset session?")) { 
                    setSession({}); 
                    setSessionStartTime(null); 
                    setElapsedTime(0); 
                    setTimerActive(false); 
                    localStorage.removeItem('elite41_start_time');
                    if (mainRef.current) mainRef.current.scrollTop = 0;
                }
            };

            return (
                <div id="root">
                    <header className="sticky-header px-4 pt-4 pb-3 shadow-sm">
                        <div className="flex justify-between items-center mb-4">
                            <div className="flex items-center gap-3">
                                <h1 className="text-[15px] font-black text-slate-900 tracking-tighter flex items-center gap-1 uppercase">
                                    <Icon name="Zap" className="text-blue-600 fill-blue-600" size={14} /> Elite41
                                </h1>
                                <div className="flex bg-slate-100 p-0.5 rounded-xl">
                                    <button onClick={() => { setTab('train'); vibrate('light'); }} className={`px-3 py-1.5 text-[10px] font-black rounded-lg transition-all ${tab==='train' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-400'}`}>TRAIN</button>
                                    <button onClick={() => { setTab('warmup'); vibrate('light'); }} className={`px-3 py-1.5 text-[10px] font-black rounded-lg transition-all ${tab==='warmup' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-400'}`}>PREP</button>
                                    <button onClick={() => { setTab('stats'); vibrate('light'); }} className={`px-3 py-1.5 text-[10px] font-black rounded-lg transition-all ${tab==='stats' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-400'}`}>STATS</button>
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                <button onClick={() => { setTimeLeft(restPreset); setTimerActive(!timerActive); vibrate('light'); }} className={`p-2 rounded-xl transition-all shadow-sm tap-active ${timerActive ? 'bg-orange-500 text-white' : 'bg-slate-100 text-slate-500'}`}>
                                    <Icon name="Timer" size={16} />
                                </button>
                                <span className="font-mono font-black text-[14px] text-slate-600 w-8 text-center">{timeLeft}s</span>
                            </div>
                        </div>

                        <div className="flex items-center justify-between gap-2">
                             <div className="flex items-center gap-1 bg-slate-50 p-1 rounded-xl">
                                <button onClick={() => { setActivePhaseIndex(0); vibrate('light'); }} className={`px-4 py-1.5 text-[10px] font-black rounded-lg transition-all ${activePhaseIndex === 0 ? 'bg-blue-600 text-white shadow-sm' : 'text-slate-400'}`}>A</button>
                                <button onClick={() => { setActivePhaseIndex(1); vibrate('light'); }} className={`px-4 py-1.5 text-[10px] font-black rounded-lg transition-all ${activePhaseIndex === 1 ? 'bg-blue-600 text-white shadow-sm' : 'text-slate-400'}`}>B</button>
                            </div>
                            <div className="flex gap-1.5">
                                <button onClick={() => { setIsTravelMode(!isTravelMode); vibrate('light'); }} className={`p-2 rounded-xl border transition-all tap-active ${isTravelMode ? 'bg-blue-100 border-blue-200 text-blue-600' : 'bg-white border-slate-200 text-slate-300'}`}><Icon name="Plane" size={16}/></button>
                                <button onClick={() => { setIsSupersetMode(!isSupersetMode); vibrate('light'); }} className={`p-2 rounded-xl border transition-all tap-active ${isSupersetMode ? 'bg-blue-100 border-blue-200 text-blue-600' : 'bg-white border-slate-200 text-slate-300'}`}><Icon name="Zap" size={16}/></button>
                                <button onClick={() => { setIsPreRunMode(!isPreRunMode); vibrate('light'); }} className={`p-2 rounded-xl border transition-all tap-active ${isPreRunMode ? 'bg-orange-100 border-orange-200 text-orange-600' : 'bg-white border-slate-200 text-slate-300'}`}><Icon name="Activity" size={16}/></button>
                            </div>
                            <div className="text-right">
                                <p className="text-[10px] font-bold text-blue-600 tracking-wide uppercase">
                                    {sessionStartTime ? formatTime(elapsedTime) : "START"}
                                </p>
                            </div>
                        </div>
                    </header>

                    <main ref={mainRef} className="main-content px-4 pt-5">
                        {tab === 'train' && (
                            <div className="space-y-6 pb-20 fade-in">
                                <div className="bg-slate-900 rounded-2xl p-4 flex items-center justify-between shadow-xl">
                                    <button onClick={() => { setActiveDayIndex(p => Math.max(0, p-1)); vibrate('light'); }} className="p-2 text-white/40 tap-active" disabled={activeDayIndex===0}><Icon name="ChevronLeft" size={20}/></button>
                                    <h2 className="font-black text-[12px] text-white uppercase tracking-widest">{activeDay.title}</h2>
                                    <button onClick={() => { setActiveDayIndex(p => Math.min(2, p+1)); vibrate('light'); }} className="p-2 text-white/40 tap-active" disabled={activeDayIndex===2}><Icon name="ChevronRight" size={20}/></button>
                                </div>

                                {activeDay.supersets.map((group, gIdx) => (
                                    <div key={gIdx} className="space-y-4">
                                        {isSupersetMode && <div className="flex items-center gap-3"><span className="text-[10px] font-black text-slate-300 uppercase tracking-widest whitespace-nowrap">BLOCK {gIdx+1}</span><div className="h-[1px] flex-1 bg-slate-100"></div></div>}
                                        {group.map(ex => {
                                            const name = isTravelMode && ex.altName ? ex.altName : ex.name;
                                            const weightLabel = isTravelMode && ex.altWeight ? ex.altWeight : ex.weight;
                                            const pr = history[ex.id] || "";
                                            return (
                                                <div key={ex.id} className={`bg-white rounded-3xl border shadow-sm ${isPreRunMode && ex.isLegs ? 'border-orange-200 ring-2 ring-orange-50' : 'border-slate-100'}`}>
                                                    <div className={`px-5 py-3.5 border-b flex items-center justify-between rounded-t-3xl ${isPreRunMode && ex.isLegs ? 'bg-orange-50/30' : 'bg-slate-50/30'}`}>
                                                        <div className="flex-1 min-w-0 mr-4">
                                                            <h3 className="font-extrabold text-[13px] text-slate-800 uppercase truncate tracking-tight">{name}</h3>
                                                            <div className="flex gap-2.5 mt-0.5">
                                                                <span className="text-[11px] font-bold text-blue-600">{weightLabel}</span>
                                                                <span className="text-[11px] font-bold text-slate-500 uppercase">{ex.reps}</span>
                                                            </div>
                                                        </div>
                                                        <input type="text" inputMode="decimal" placeholder="LBS" className="w-16 bg-white border border-slate-200 rounded-xl px-3 py-2 text-[14px] font-black text-blue-600 outline-none text-right focus:border-blue-400 focus:ring-2 focus:ring-blue-50 transition-all" value={pr} onChange={(e) => setHistory({...history, [ex.id]: e.target.value})} />
                                                    </div>
                                                    <div className="p-3.5 flex gap-3">
                                                        {[0, 1, 2].map(sIdx => {
                                                            const isDone = !!session[`${ex.id}-${sIdx}`];
                                                            return (
                                                                <button key={sIdx} onClick={() => handleToggleSet(ex.id, sIdx)} className={`flex-1 py-4 rounded-2xl border-2 flex items-center justify-center transition-all tap-active ${isDone ? 'bg-blue-600 border-blue-600 text-white shadow-lg' : 'bg-white border-slate-50 text-slate-100'}`}>
                                                                    <Icon name={isDone ? "Check" : "Circle"} size={22} />
                                                                </button>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                ))}
                                <div className="pt-8 px-2 pb-12">
                                    <button onClick={handleCompleteSession} className="w-full py-6 bg-slate-900 text-white rounded-3xl font-black uppercase text-[12px] tracking-widest shadow-2xl tap-active transition-all">Complete Workout</button>
                                </div>
                            </div>
                        )}

                        {tab === 'warmup' && (
                            <div className="bg-white border border-slate-100 rounded-3xl p-6 mb-20 space-y-6 fade-in shadow-sm">
                                <h3 className="font-black text-slate-400 uppercase tracking-widest text-[11px]">Movement Prep</h3>
                                {WARMUPS.map((w, i) => (
                                    <div key={i} className="flex gap-5 items-center border-b border-slate-50 pb-5 last:border-0 last:pb-0">
                                        <div className="w-8 h-8 rounded-xl bg-blue-50 text-blue-600 flex items-center justify-center font-black text-sm shrink-0">{i+1}</div>
                                        <div>
                                            <p className="text-[14px] font-extrabold text-slate-800 leading-tight">{w.name}</p>
                                            <p className="text-[11px] font-bold text-slate-400 mt-1.5 uppercase">{w.reps}</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {tab === 'stats' && (
                            <div className="space-y-4 pb-20 fade-in">
                                <h3 className="font-black text-slate-400 uppercase tracking-widest text-[11px] px-2">Lifting Records</h3>
                                {Object.entries(history).length > 0 ? Object.entries(history).map(([id, val]) => (
                                    <div key={id} className="bg-white p-5 rounded-2xl border border-slate-100 flex justify-between items-center shadow-sm">
                                        <h4 className="font-bold text-slate-500 text-[12px] uppercase tracking-tight">{id.replace(/_/g, ' ')}</h4>
                                        <div className="bg-blue-50 px-4 py-1.5 rounded-xl">
                                            <p className="text-sm font-black text-blue-600">{val} LB</p>
                                        </div>
                                    </div>
                                )) : <p className="text-center py-20 text-slate-300 font-black uppercase text-[11px] tracking-widest">No records yet</p>}
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
