<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Elite41 Power Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        html, body, #root { height: 100%; width: 100%; margin: 0; padding: 0; overflow: hidden; background-color: #ffffff; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        .fade-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .compact-toggle-btn { display: flex; align-items: center; justify-content: center; padding: 6px 12px; border-radius: 8px; font-size: 10px; font-weight: 800; transition: all 0.2s; border: 1px solid #e2e8f0; background: #f8fafc; color: #64748b; }
        .compact-toggle-btn.active { background: #2563eb; border-color: #2563eb; color: white; }
        .compact-toggle-btn.active-orange { background: #f97316; border-color: #f97316; color: white; }
        .set-btn { height: 52px; border-width: 2.5px; transition: all 0.1s ease; }
        .progress-bar-container { height: 3px; width: 100%; background: #f1f5f9; }
        .progress-bar-fill { height: 100%; background: #2563eb; transition: width 0.5s ease; }
        .dimmed { opacity: 0.4; filter: grayscale(0.5); pointer-events: none; }
        .active-focus { transform: scale(1.01); border-color: #2563eb !important; box-shadow: 0 10px 20px -5px rgba(37, 99, 235, 0.1); }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Load React and Babel at the end of the body to ensure DOM is ready -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        const Icon = ({ name, size = 24, className = "" }) => {
            const kebabName = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });
            return <i data-lucide={kebabName} className={className} style={{ width: size, height: size, display: 'inline-block' }}></i>;
        };

        const playBeep = (freq = 440, duration = 0.1) => {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, ctx.currentTime);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                osc.stop(ctx.currentTime + duration);
            } catch(e) {}
        };

        const PHASES = [
            { id: 0, name: "Phase A", days: [{ id: 0, title: "Day 1: Posterior & Pull", supersets: [[{ id: "tbdl", name: "Trap Bar Deadlift", altName: "DB Suitcase DL", reps: "5-8", weight: "Trap Bar", altWeight: "DBs", isLegs: true }, { id: "dbrow", name: "DB One-Arm Row", reps: "10-12", weight: "DB" }], [{ id: "dbgoblet", name: "DB Goblet Squat", reps: "12-15", weight: "DB", isLegs: true }, { id: "dboh", name: "DB Overhead Press", reps: "8-10", weight: "DB" }]] }, { id: 1, title: "Day 2: Chest & Core", supersets: [[{ id: "dbbench", name: "DB Bench Press", reps: "8-10", weight: "DB" }, { id: "tbrdl", name: "Trap Bar RDL", altName: "DB RDL", reps: "10-12", weight: "Trap Bar", altWeight: "DBs", isLegs: true }], [{ id: "dbcsr", name: "DB Chest Supported Row", reps: "10-12", weight: "DB" }, { id: "dbren", name: "DB Renegade Rows", reps: "8/side", weight: "DB" }]] }, { id: 2, title: "Day 3: Legs & Stability", supersets: [[{ id: "tbsquat", name: "Trap Bar Squat", altName: "DB Goblet Squat", reps: "8-10", weight: "Trap Bar", altWeight: "DBs", isLegs: true }, { id: "dbinc", name: "DB Incline Bench Press", reps: "10-12", weight: "DB" }], [{ id: "dbbulg", name: "DB Bulgarian Split Squat", reps: "8-10", weight: "DB", isLegs: true }, { id: "dbcurls", name: "DB Bicep Curls", reps: "12-15", weight: "DB" }]] }] },
            { id: 1, name: "Phase B", days: [{ id: 0, title: "Day 1: Pull & Shrug", supersets: [[{ id: "tbdl_sh", name: "Trap Bar Shrug DL", altName: "DB Shrug DL", reps: "8-10", weight: "Trap Bar", altWeight: "DBs", isLegs: true }, { id: "db_seesaw", name: "DB Seesaw Row", reps: "12/side", weight: "DB" }], [{ id: "db_lat_lunge", name: "DB Lateral Lunge", reps: "10/side", weight: "DB", isLegs: true }, { id: "db_arnold", name: "DB Arnold Press", reps: "10-12", weight: "DB" }]] }, { id: 1, title: "Day 2: Push & Carry", supersets: [[{ id: "db_floor", name: "DB Floor Press", reps: "10-12", weight: "DB" }, { id: "tbrdl_b", name: "Trap Bar RDL", altName: "DB RDL", reps: "12-15", weight: "Trap Bar", altWeight: "DBs", isLegs: true }], [{ id: "db_pull", name: "DB Pullover", reps: "12-15", weight: "DB" }, { id: "db_carry", name: "DB Suitcase Carry", reps: "30yd/side", weight: "DB" }]] }, { id: 2, title: "Day 3: Quads & Isos", supersets: [[{ id: "tbsq_b", name: "Trap Bar Squat", altName: "DB Goblet Squat", reps: "10-12", weight: "Trap Bar", altWeight: "DBs", isLegs: true }, { id: "db_fly", name: "DB Incline Fly", reps: "12-15", weight: "DB" }], [{ id: "db_step", name: "DB Step Ups", reps: "10/side", weight: "DB", isLegs: true }, { id: "db_ham", name: "DB Hammer Curls", reps: "12-15", weight: "DB" }]] }] }
        ];

        function App() {
            const [activePhaseIndex, setActivePhaseIndex] = useState(() => Number(localStorage.getItem('elite41_phase') || 0));
            const [activeDayIndex, setActiveDayIndex] = useState(0);
            const [isTravelMode, setIsTravelMode] = useState(() => localStorage.getItem('elite41_travel') === 'true');
            const [isSupersetMode, setIsSupersetMode] = useState(() => (localStorage.getItem('elite41_supersets') || 'true') === 'true');
            const [isPreRunMode, setIsPreRunMode] = useState(() => localStorage.getItem('elite41_prerun') === 'true');
            const [history, setHistory] = useState(() => JSON.parse(localStorage.getItem('elite41_history') || '{}'));
            const [session, setSession] = useState(() => JSON.parse(localStorage.getItem('elite41_session') || '{}'));
            const [timerActive, setTimerActive] = useState(false);
            const [timeLeft, setTimeLeft] = useState(60);
            const [restPreset, setRestPreset] = useState(60);
            const [sessionStartTime, setSessionStartTime] = useState(() => localStorage.getItem('elite41_start_time') ? Number(localStorage.getItem('elite41_start_time')) : null);
            
            const activeDay = PHASES[activePhaseIndex].days[activeDayIndex];

            const progress = useMemo(() => {
                const totalSets = activeDay.supersets.flat().length * 3;
                const completed = Object.keys(session).filter(k => session[k]).length;
                return totalSets === 0 ? 0 : (completed / totalSets) * 100;
            }, [activeDay, session]);

            const nextFocusId = useMemo(() => {
                if (!timerActive) return null;
                const allEx = activeDay.supersets.flat();
                for (let ex of allEx) {
                    for (let i = 0; i < 3; i++) if (!session[`${ex.id}-${i}`]) return ex.id;
                }
                return null;
            }, [timerActive, activeDay, session]);

            useEffect(() => {
                localStorage.setItem('elite41_phase', activePhaseIndex);
                localStorage.setItem('elite41_travel', isTravelMode);
                localStorage.setItem('elite41_supersets', isSupersetMode);
                localStorage.setItem('elite41_prerun', isPreRunMode);
                localStorage.setItem('elite41_history', JSON.stringify(history));
                localStorage.setItem('elite41_session', JSON.stringify(session));
                if (sessionStartTime) localStorage.setItem('elite41_start_time', sessionStartTime);
            }, [activePhaseIndex, isTravelMode, isSupersetMode, isPreRunMode, history, session, sessionStartTime]);

            useEffect(() => {
                let int;
                if (timerActive && timeLeft > 0) int = setInterval(() => setTimeLeft(t => t - 1), 1000);
                else if (timeLeft === 0) { setTimerActive(false); playBeep(880, 0.2); }
                return () => clearInterval(int);
            }, [timerActive, timeLeft]);

            return (
                <div className="flex flex-col h-full bg-white">
                    <header className="px-4 pt-3 pb-2 flex flex-col gap-3 shadow-sm">
                        <div className="flex justify-between items-center">
                            <h1 className="text-[11px] font-black uppercase flex items-center gap-1">
                                <Icon name="Zap" className="text-blue-600" size={14} /> ELITE41
                            </h1>
                            <div className="flex gap-2">
                                <button onClick={() => { setTimeLeft(restPreset); setTimerActive(true); }} className={`px-3 py-1.5 rounded-full text-xs font-black ${timerActive ? 'bg-orange-500 text-white' : 'bg-slate-100 text-slate-500'}`}>
                                    {timeLeft}s
                                </button>
                                <select className="bg-slate-100 text-[10px] rounded-full px-2 outline-none" value={restPreset} onChange={(e) => setRestPreset(Number(e.target.value))}>
                                    <option value={60}>1m</option><option value={90}>1.5m</option>
                                </select>
                            </div>
                        </div>
                        <div className="flex gap-1">
                            <button onClick={() => setIsTravelMode(!isTravelMode)} className={`compact-toggle-btn ${isTravelMode ? 'active' : ''}`}>TRAVEL</button>
                            <button onClick={() => setIsSupersetMode(!isSupersetMode)} className={`compact-toggle-btn ${isSupersetMode ? 'active' : ''}`}>SUPER</button>
                            <button onClick={() => setIsPreRunMode(!isPreRunMode)} className={`compact-toggle-btn ${isPreRunMode ? 'active-orange' : ''}`}>PRE</button>
                        </div>
                    </header>
                    <div className="progress-bar-container"><div className="progress-bar-fill" style={{ width: `${progress}%` }}></div></div>
                    <main className="flex-1 overflow-y-auto px-4 py-4 space-y-4 scrollbar-hide">
                        <div className="bg-slate-900 rounded-2xl p-4 flex justify-between items-center text-white">
                            <button onClick={() => setActiveDayIndex(Math.max(0, activeDayIndex-1))} className="p-1"><Icon name="ChevronLeft" /></button>
                            <span className="text-[10px] font-black uppercase tracking-widest">{activeDay.title}</span>
                            <button onClick={() => setActiveDayIndex(Math.min(2, activeDayIndex+1))} className="p-1"><Icon name="ChevronRight" /></button>
                        </div>
                        {activeDay.supersets.map((group, gIdx) => (
                            <div key={gIdx} className="space-y-3">
                                {group.map(ex => (
                                    <div key={ex.id} className={`bg-white rounded-2xl border-2 p-4 transition-all ${nextFocusId && nextFocusId !== ex.id ? 'dimmed' : ''} ${nextFocusId === ex.id ? 'active-focus' : 'border-slate-100'}`}>
                                        <div className="flex justify-between items-start mb-4">
                                            <div>
                                                <h3 className="font-black text-sm">{isTravelMode ? ex.altName || ex.name : ex.name}</h3>
                                                <p className="text-[10px] text-slate-400 font-bold uppercase">{ex.reps} REPS</p>
                                            </div>
                                            <input type="number" placeholder="LBS" className="w-16 bg-slate-50 border-none rounded-lg p-2 text-right text-xs font-black outline-none" value={history[ex.id] || ""} onChange={(e) => setHistory({...history, [ex.id]: e.target.value})} />
                                        </div>
                                        <div className="flex gap-2">
                                            {[0,1,2].map(sIdx => {
                                                const isDone = !!session[`${ex.id}-${sIdx}`];
                                                return (
                                                    <button key={sIdx} onClick={() => {
                                                        if (!sessionStartTime) setSessionStartTime(Date.now());
                                                        setSession({...session, [`${ex.id}-${sIdx}`]: !isDone});
                                                        if (!isDone) { setTimeLeft(restPreset); setTimerActive(true); }
                                                    }} className={`flex-1 set-btn rounded-xl font-black text-xs ${isDone ? 'bg-blue-600 border-blue-600 text-white' : 'bg-slate-50 border-slate-100 text-slate-300'}`}>
                                                        {isDone ? "âœ“" : sIdx + 1}
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ))}
                        <button onClick={() => { if(confirm("End Session?")) { setSession({}); setSessionStartTime(null); setTimerActive(false); localStorage.removeItem('elite41_session'); location.reload(); } }} className="w-full py-5 bg-blue-600 text-white rounded-2xl font-black uppercase text-xs mb-8">Complete Workout</button>
                    </main>
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
